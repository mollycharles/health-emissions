#                   values = brewer.pal(length(plot_countries), "Dark2")) +
# scale_shape_manual(name = "Country",
#                    values = c(21, 22, 25, 23, 24)) +
plot_theme
animate(plot, nframes = 300, fps = 3, width = 600, height = 400, start_pause = 5, end_pause = 20)
anim_save(plot, filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
source("./data_processing.R")
library(gganimate)
library(RColorBrewer)
em_species <- c("BC", "CH4", "CO", "NH3", "NMVOC", "NOx", "OC", "SO2")
health_indicators <- c("Air pollution / All risk factors", "Environ-Occup / All risk factors")
measures <- c("Deaths", "DALYs")
SDI_groups <- c("Low SDI", "Low-middle SDI", "Middle SDI", "High-middle SDI", "High SDI")
plot_theme <- theme_bw() + theme(text = element_text(size = 18),
plot.title = element_text(size = 24, margin = margin(0, 0, 10, 0)),
strip.text.x = element_text(size = 14),
axis.title = element_text(size = 14))
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
# shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India"))
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
# shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme +
animate(nframes = 300, fps = 5, width = 600, height = 400, start_pause = 5, end_pause = 20) +
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
# shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(nframes = 300, fps = 5, width = 600, height = 400, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
plot <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
# shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(plot, nframes = 300, fps = 5, width = 600, height = 400, start_pause = 5, end_pause = 20)
anim_save(plot, filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
p <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(p, nframes = 200, fps = 3, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
p <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(p, nframes = 200, fps = 5, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
View(PM_deaths_frac_cntry_allyears_extrap)
View(PM_deaths_frac_cntry_allyears_extrap)
p <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of all deaths from ambient PM pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(p, nframes = 200, fps = 5, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
View(GBD_population_PM)
p <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of Deaths from Ambient PM Pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(p, nframes = 200, fps = 5, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
p <-
ggplot() +
geom_point(data=filter(PM_deaths_frac_cntry_allyears_extrap, year %in% c(1850:2015)),
aes(x=(non_FFI / total_pm), y=val, color = iso, fill = iso,  shape = iso), size = 7) +
shadow_mark(past = TRUE, future = FALSE, size = 0.8) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Non-Fossil_Industrial Fraction of Composite PM Emissions",
y = "Fraction of Deaths from Ambient PM Pollution") +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_fill_manual(name = "Country",
values = brewer.pal(3, "Dark2"),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
scale_shape_manual(name = "Country",
values = c(21, 22, 23),
labels = c("fra" = "France", "chn" = "China", "ind" = "India")) +
plot_theme
animate(p, nframes = 200, fps = 5, start_pause = 5, end_pause = 20)
anim_save(filename="./figures/selected_countries_PM_share_deaths_extrap.gif")
debugSource('~/Air pollution health emissions/data_processing.R', echo=TRUE)
PM_emissions <- function(emissions_df, PM_conversion_factor, em_type) {
df_out <- emissions_df %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_conversion_factor) %>%
dplyr::mutate(em_type = em_type)
}
PM_BC <- bind_rows(PM_emissions(FFI_em(CEDS_BC), PM_CF_BC, "FFI"),
PM_emissions(nonFFI_em(CEDS_BC, GFED_BC), PM_CF_BC, "non_FFI")) %>%
dplyr::mutate(species = "BC") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_NH3 <- bind_rows(PM_emissions(FFI_em(CEDS_NH3), PM_CF_NH3, "FFI"),
PM_emissions(nonFFI_em(CEDS_NH3, GFED_NH3), PM_CF_NH3, "non_FFI")) %>%
dplyr::mutate(species = "NH3") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_NOx <- bind_rows(PM_emissions(FFI_em(CEDS_NOx), PM_CF_NO2, "FFI"),
PM_emissions(nonFFI_em(CEDS_NOx, GFED_NOx), PM_CF_NO2, "non_FFI")) %>%
dplyr::mutate(species = "NOx") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_SO2 <- bind_rows(PM_emissions(FFI_em(CEDS_SO2), PM_CF_SO2, "FFI"),
PM_emissions(nonFFI_em(CEDS_SO2, GFED_SO2), PM_CF_SO2, "non_FFI")) %>%
dplyr::mutate(species = "SO2") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_OC <- bind_rows(PM_emissions(FFI_em(CEDS_OC), PM_CF_OC_fossil, "FFI"),
PM_emissions(nonFFI_em(CEDS_OC, GFED_OC), PM_CF_OC_biomass, "non_FFI")) %>%
dplyr::mutate(species = "OC") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_composition <- bind_rows(PM_BC, PM_NH3, PM_NOx, PM_SO2, PM_OC)  %>%
dplyr::mutate(total_pm = FFI + non_FFI) %>%
left_join(cntry_mapping, by = "iso") %>%
select(c(iso, location_id, year, species, FFI, non_FFI, total_pm, `SDI Quintile`)) %>%
na.omit()
# Add to get composite PM
composite_PM <- bind_rows(PM_BC, PM_NH3, PM_NOx, PM_SO2, PM_OC) %>%
group_by_at(vars(iso, year)) %>%
dplyr::summarise(FFI = sum(FFI, na.rm=TRUE),
non_FFI = sum(non_FFI, na.rm = TRUE)) %>%
dplyr::mutate(total_pm = FFI + non_FFI) %>%
left_join(cntry_mapping, by = "iso") %>%
select(c(iso, location_id, year, FFI, non_FFI, total_pm, `SDI Quintile`))
composite_PM_FFI_fraction <- composite_PM %>%
dplyr::mutate(FFI_fraction = FFI / total_pm,
non_FFI_fraction = non_FFI / total_pm) %>%
select(c(iso,  location_id, year, FFI_fraction, non_FFI_fraction, `SDI Quintile`))
composite_PM_FFI_fraction_grouped <- composite_PM %>%
group_by_at(vars(year, `SDI Quintile`)) %>%
dplyr::summarise(FFI = sum(FFI, na.rm=TRUE),
non_FFI = sum(non_FFI, na.rm = TRUE),
total_pm = sum(total_pm, na.rm = TRUE)) %>%
dplyr::mutate(FFI_fraction = FFI / total_pm,
non_FFI_fraction = non_FFI / total_pm) %>%
na.omit()
# Check country shares of PM emissions by SDI category
cntry_PM_shares <- composite_PM %>%
dplyr::rename(cntry_pm = total_pm) %>%
left_join(composite_PM_FFI_fraction_grouped, by = c("year", "SDI Quintile")) %>%
select(iso, location_id, year, cntry_pm, `SDI Quintile`, total_pm) %>%
na.omit() %>%
dplyr::mutate(cntry_share_PM = cntry_pm / total_pm)
# Combine with global burden of disease data
GBD_composite_PM <- GBD_shares %>%
left_join(composite_PM_FFI_fraction, by = c("location_id", "year")) %>%
na.omit() %>%
left_join(select(cntry_PM_shares, -c(total_pm)), by = c("iso", "location_id", "year", "SDI Quintile"))
GBD_composite_PM_grouped <- GBD_shares_grouped %>% left_join(composite_PM_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GFED_timeAvg <- function(GFED_in) {
df_out <- GFED_in %>%
select(iso, sector, GFED_years) %>%
gather(GFED_years, key="year", value="value") %>%
group_by(iso) %>%
dplyr::summarise(value_timeAvg = mean(value, na.rm=TRUE))
}
nonFFI_em_BioBAvg <- function(CEDS_in, GFED_in_timeAvg) {
df_out <- CEDS_in %>%
filter(fuel == "biomass" | sector == "5C_Waste-incineration") %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
select(iso, CEDS_years) %>%
gather(GBD_years, key="year", value = "value") %>%
left_join(GFED_in_timeAvg, by="iso") %>%
dplyr::mutate(value = value + value_timeAvg) %>%
select(-value_timeAvg) %>%
spread(year, value)
}
# PM emissions by species
PM_BC_BioBAvg <- bind_rows(PM_emissions(FFI_em(CEDS_BC), PM_CF_BC, "FFI"),
PM_emissions(nonFFI_em_BioBAvg(CEDS_BC, GFED_timeAvg(GFED_BC)), PM_CF_BC, "non_FFI")) %>%
dplyr::mutate(species = "BC") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_NH3_BioBAvg <- bind_rows(PM_emissions(FFI_em(CEDS_NH3), PM_CF_NH3, "FFI"),
PM_emissions(nonFFI_em_BioBAvg(CEDS_NH3, GFED_timeAvg(GFED_NH3)), PM_CF_NH3, "non_FFI")) %>%
dplyr::mutate(species = "NH3") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_NOx_BioBAvg <- bind_rows(PM_emissions(FFI_em(CEDS_NOx), PM_CF_NO2, "FFI"),
PM_emissions(nonFFI_em_BioBAvg(CEDS_NOx, GFED_timeAvg(GFED_NOx)), PM_CF_NO2, "non_FFI")) %>%
dplyr::mutate(species = "NOx") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_SO2_BioBAvg <- bind_rows(PM_emissions(FFI_em(CEDS_SO2), PM_CF_SO2, "FFI"),
PM_emissions(nonFFI_em_BioBAvg(CEDS_SO2, GFED_timeAvg(GFED_SO2)), PM_CF_SO2, "non_FFI")) %>%
dplyr::mutate(species = "SO2") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_OC_BioBAvg <- bind_rows(PM_emissions(FFI_em(CEDS_OC), PM_CF_OC_fossil, "FFI"),
PM_emissions(nonFFI_em_BioBAvg(CEDS_OC, GFED_timeAvg(GFED_OC)), PM_CF_OC_biomass, "non_FFI")) %>%
dplyr::mutate(species = "OC") %>%
select(-value_em) %>%
spread(em_type, value_pm)
PM_composition_BioBAvg <- bind_rows(PM_BC_BioBAvg, PM_NH3_BioBAvg, PM_NOx_BioBAvg, PM_SO2_BioBAvg, PM_OC_BioBAvg)  %>%
dplyr::mutate(total_pm = FFI + non_FFI) %>%
left_join(cntry_mapping, by = "iso") %>%
select(c(iso, location_id, year, species, FFI, non_FFI, total_pm, `SDI Quintile`)) %>%
na.omit()
# Add to get composite PM
composite_PM_BioBAvg <- bind_rows(PM_BC_BioBAvg, PM_NH3_BioBAvg, PM_NOx_BioBAvg, PM_SO2_BioBAvg, PM_OC_BioBAvg) %>%
group_by_at(vars(iso, year)) %>%
dplyr::summarise(FFI = sum(FFI, na.rm=TRUE),
non_FFI = sum(non_FFI, na.rm = TRUE)) %>%
dplyr::mutate(total_pm = FFI + non_FFI) %>%
left_join(cntry_mapping, by = "iso") %>%
select(c(iso, location_id, year, FFI, non_FFI, total_pm, `SDI Quintile`))
composite_PM_FFI_fraction_BioBAvg <- composite_PM_BioBAvg %>%
dplyr::mutate(FFI_fraction = FFI / total_pm,
non_FFI_fraction = non_FFI / total_pm) %>%
select(c(iso,  location_id, year, FFI_fraction, non_FFI_fraction, total_pm, `SDI Quintile`))
composite_PM_FFI_fraction_grouped_BioBAvg <- composite_PM_BioBAvg %>%
group_by_at(vars(year, `SDI Quintile`)) %>%
dplyr::summarise(FFI = sum(FFI, na.rm=TRUE),
non_FFI = sum(non_FFI, na.rm = TRUE),
total_pm = sum(total_pm, na.rm = TRUE)) %>%
dplyr::mutate(FFI_fraction = FFI / total_pm,
non_FFI_fraction = non_FFI / total_pm) %>%
na.omit()
# Combine with global burden of disease data
GBD_composite_PM_BioBAvg <- GBD_shares %>%
left_join(composite_PM_FFI_fraction_BioBAvg, by = c("location_id", "year")) %>%
na.omit()
GBD_composite_PM_grouped_BioBAvg <- GBD_shares_grouped %>% left_join(composite_PM_FFI_fraction_grouped_BioBAvg, by = c("SDI Quintile", "year"))
PM_species <- c("BC", "NH3", "NO2", "SO2", "OC")
PM_CEDS_BC <- CEDS_BC %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_BC) %>%
dplyr::mutate(em_type = "BC")
PM_CEDS_NH3 <- CEDS_NH3 %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_NH3) %>%
dplyr::mutate(em_type = "NH3")
PM_CEDS_NO2 <- CEDS_NOx %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_NO2) %>%
dplyr::mutate(em_type = "NO2")
PM_CEDS_SO2 <- CEDS_SO2 %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_SO2) %>%
dplyr::mutate(em_type = "SO2")
PM_CEDS_OC_fossil <- CEDS_OC %>%
filter(!fuel == "biomass") %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_OC_fossil) %>%
dplyr::mutate(em_type = "OC")
PM_CEDS_OC_bio <- CEDS_OC %>%
filter(fuel == "biomass") %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_OC_biomass) %>%
dplyr::mutate(em_type = "OC")
PM_CEDS_total <- bind_rows(PM_CEDS_BC, PM_CEDS_NH3, PM_CEDS_NO2, PM_CEDS_SO2, PM_CEDS_OC_fossil, PM_CEDS_OC_bio) %>%
group_by_at(vars(iso, year, em_type)) %>%
dplyr::summarise(value_pm = sum(value_pm)) %>%
spread(em_type, value_pm)
open_burn_avg_PM_em <- bind_rows(GFED_timeAvg(GFED_BC) %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_timeAvg(GFED_NH3) %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_timeAvg(GFED_NOx) %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_timeAvg(GFED_SO2) %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_timeAvg(GFED_OC) %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass)) %>%
dplyr::mutate(PM_em = value_timeAvg * EF) %>%
group_by(iso) %>%
dplyr::summarise(open_burn = sum(PM_em, na.rm = TRUE))
PM_composition_open_burn_BioBAvg <- PM_CEDS_total %>%
left_join(open_burn_avg_PM_em, by = c("iso")) %>%
gather(c(BC, NH3, NO2, OC, SO2, open_burn), key = "emissions_type", value = "value")
BC_FFI_fraction <- FFI_fraction(CEDS_BC, GFED_BC)
CH4_FFI_fraction <- FFI_fraction(CEDS_CH4, GFED_CH4)
CO_FFI_fraction <- FFI_fraction(CEDS_CO, GFED_CO)
NH3_FFI_fraction <- FFI_fraction(CEDS_NH3, GFED_NH3)
NMVOC_FFI_fraction <- FFI_fraction(CEDS_NMVOC, GFED_NMVOC)
NOx_FFI_fraction <- FFI_fraction(CEDS_NOx, GFED_NOx)
OC_FFI_fraction <- FFI_fraction(CEDS_OC, GFED_OC)
SO2_FFI_fraction <- FFI_fraction(CEDS_SO2, GFED_SO2)
BC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_BC, GFED_BC)
CH4_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_CH4, GFED_CH4)
CO_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_CO, GFED_CO)
NH3_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NH3, GFED_NH3)
NMVOC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NMVOC, GFED_NMVOC)
NOx_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NOx, GFED_NOx)
OC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_OC, GFED_OC)
SO2_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_SO2, GFED_SO2)
GBD_BC <- GBD_shares %>% left_join(BC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_CH4 <- GBD_shares %>% left_join(CH4_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_CO <- GBD_shares %>% left_join(CO_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NH3 <- GBD_shares %>% left_join(NH3_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NMVOC <- GBD_shares %>% left_join(NMVOC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NOx <- GBD_shares %>% left_join(NOx_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_OC <- GBD_shares %>% left_join(OC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_SO2 <- GBD_shares %>% left_join(SO2_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
# Grouped by SDI category
GBD_BC_SDI_groups <- GBD_shares_grouped %>% left_join(BC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_CH4_SDI_groups <- GBD_shares_grouped %>% left_join(CH4_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_CO_SDI_groups <- GBD_shares_grouped %>% left_join(CO_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NH3_SDI_groups <- GBD_shares_grouped %>% left_join(NH3_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NMVOC_SDI_groups <- GBD_shares_grouped %>% left_join(NMVOC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NOx_SDI_groups <- GBD_shares_grouped %>% left_join(NOx_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_OC_SDI_groups <- GBD_shares_grouped %>% left_join(OC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_SO2_SDI_groups <- GBD_shares_grouped %>% left_join(SO2_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
# Merge composite PM emissions, GBD data, and population
GBD_population_PM <- GBD_composite_PM %>% left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = cntry_pm * pop)
GBD_population_PM_BioBAvg <- GBD_composite_PM_BioBAvg %>% left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop)
extrap_years <- c(1850:1989)
extrap_isos <- c("chn", "ind", "fra")
actual_years <- c(1990:2017)
fra_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "fra", year <= 2002,
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
ind_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "ind",
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
chn_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "chn", year <= 1996,
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
extrap_PM_deaths_frac <- composite_PM %>%
left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop) %>%
na.omit() %>%
left_join(filter(GBD_shares, measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"), by = c("location_id", "year")) %>%
select(c(iso, location_id, country, year, total_pm, FFI, non_FFI, `SDI Quintile`, rei_name, pop, pm_pop, val)) %>%
filter(year %in% extrap_years,
iso %in% extrap_isos)
actual_PM_deaths_frac <- composite_PM %>%
left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop) %>%
na.omit() %>%
left_join(filter(GBD_shares, measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"), by = c("location_id", "year")) %>%
select(c(iso, location_id, country, year, total_pm, FFI, non_FFI, `SDI Quintile`, rei_name, pop, pm_pop, val)) %>%
filter(year %in% actual_years,
iso %in% extrap_isos)
extrap_PM_deaths_chn <- extrap_PM_deaths_frac %>%
filter(iso == "chn")
extrap_PM_deaths_chn$val <- predict(chn_PM_deaths_lm, new = extrap_PM_deaths_chn)
extrap_PM_deaths_ind <- extrap_PM_deaths_frac %>%
filter(iso == "ind")
extrap_PM_deaths_ind$val <- predict(ind_PM_deaths_lm, new = extrap_PM_deaths_ind)
extrap_PM_deaths_fra <- extrap_PM_deaths_frac %>%
filter(iso == "fra")
extrap_PM_deaths_fra$val <- predict(fra_PM_deaths_lm, new = extrap_PM_deaths_fra)
PM_deaths_frac_cntry_allyears_extrap <- bind_rows(actual_PM_deaths_frac,
extrap_PM_deaths_chn,
extrap_PM_deaths_ind,
extrap_PM_deaths_fra)
View(GBD_composite_PM)
View(GFED_BC)
