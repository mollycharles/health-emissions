PM_CEDS_NH3 <- CEDS_NH3 %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_NH3) %>%
dplyr::mutate(em_type = "NH3")
PM_CEDS_NO2 <- CEDS_NOx %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_NO2) %>%
dplyr::mutate(em_type = "NO2")
PM_CEDS_SO2 <- CEDS_SO2 %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_SO2) %>%
dplyr::mutate(em_type = "SO2")
PM_CEDS_OC_fossil <- CEDS_OC %>%
filter(!fuel == "biomass") %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_OC_fossil) %>%
dplyr::mutate(em_type = "OC")
PM_CEDS_OC_bio <- CEDS_OC %>%
filter(fuel == "biomass") %>%
group_by(iso) %>%
summarise_at(c(CEDS_years), sum, na.rm = TRUE) %>%
gather(CEDS_years, key = "year", value = "value_em") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(value_pm = value_em * PM_CF_OC_biomass) %>%
dplyr::mutate(em_type = "OC")
PM_CEDS_total <- bind_rows(PM_CEDS_BC, PM_CEDS_NH3, PM_CEDS_NO2, PM_CEDS_SO2, PM_CEDS_OC_fossil, PM_CEDS_OC_bio) %>%
group_by_at(vars(iso, year, em_type)) %>%
dplyr::summarise(value_pm = sum(value_pm)) %>%
spread(em_type, value_pm)
open_burn_avg_PM_em <- bind_rows(GFED_timeAvg(GFED_BC) %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_timeAvg(GFED_NH3) %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_timeAvg(GFED_NOx) %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_timeAvg(GFED_SO2) %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_timeAvg(GFED_OC) %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass))
open_burn_avg_PM_em <- bind_rows(GFED_BC_BioBAvg %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_NH3_BioBAvg %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_NOx_BioBAvg %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_SO2_BioBAvg %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_OC_BioBAvg %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass))
View(open_burn_avg_PM_em)
open_burn_avg_PM_em <- bind_rows(GFED_BC_BioBAvg %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_NH3_BioBAvg %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_NOx_BioBAvg %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_SO2_BioBAvg %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_OC_BioBAvg %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass)) %>%
gather(-c(iso, species, EF), key = "year", value = "value_timeAvg")
open_burn_avg_PM_em <- bind_rows(GFED_BC_BioBAvg %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_NH3_BioBAvg %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_NOx_BioBAvg %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_SO2_BioBAvg %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_OC_BioBAvg %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass)) %>%
gather(-c(iso, species, EF), key = "year", value = "value_timeAvg") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(PM_em = value_timeAvg * EF) %>%
group_by(iso) %>%
dplyr::summarise(open_burn = sum(PM_em, na.rm = TRUE))
PM_composition_open_burn_BioBAvg <- PM_CEDS_total %>%
left_join(open_burn_avg_PM_em, by = c("iso")) %>%
gather(c(BC, NH3, NO2, OC, SO2, open_burn), key = "emissions_type", value = "value")
# Get fossil fraction of emissions by species ------------------------------------------------------------------------------------------
BC_FFI_fraction <- FFI_fraction(CEDS_BC, GFED_BC)
CH4_FFI_fraction <- FFI_fraction(CEDS_CH4, GFED_CH4)
CO_FFI_fraction <- FFI_fraction(CEDS_CO, GFED_CO)
NH3_FFI_fraction <- FFI_fraction(CEDS_NH3, GFED_NH3)
NMVOC_FFI_fraction <- FFI_fraction(CEDS_NMVOC, GFED_NMVOC)
NOx_FFI_fraction <- FFI_fraction(CEDS_NOx, GFED_NOx)
OC_FFI_fraction <- FFI_fraction(CEDS_OC, GFED_OC)
SO2_FFI_fraction <- FFI_fraction(CEDS_SO2, GFED_SO2)
# Grouped by SDI category
BC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_BC, GFED_BC)
CH4_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_CH4, GFED_CH4)
CO_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_CO, GFED_CO)
NH3_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NH3, GFED_NH3)
NMVOC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NMVOC, GFED_NMVOC)
NOx_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_NOx, GFED_NOx)
OC_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_OC, GFED_OC)
SO2_FFI_fraction_grouped <- FFI_fraction_grouped(CEDS_SO2, GFED_SO2)
# Merge GBD data and fossil fraction of emissions, by emissions species ----------------------------------------------------------------
GBD_BC <- GBD_shares %>% left_join(BC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_CH4 <- GBD_shares %>% left_join(CH4_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_CO <- GBD_shares %>% left_join(CO_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NH3 <- GBD_shares %>% left_join(NH3_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NMVOC <- GBD_shares %>% left_join(NMVOC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_NOx <- GBD_shares %>% left_join(NOx_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_OC <- GBD_shares %>% left_join(OC_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
GBD_SO2 <- GBD_shares %>% left_join(SO2_FFI_fraction, by=c("location_id", "year")) %>% na.omit()
# Grouped by SDI category
GBD_BC_SDI_groups <- GBD_shares_grouped %>% left_join(BC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_CH4_SDI_groups <- GBD_shares_grouped %>% left_join(CH4_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_CO_SDI_groups <- GBD_shares_grouped %>% left_join(CO_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NH3_SDI_groups <- GBD_shares_grouped %>% left_join(NH3_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NMVOC_SDI_groups <- GBD_shares_grouped %>% left_join(NMVOC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_NOx_SDI_groups <- GBD_shares_grouped %>% left_join(NOx_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_OC_SDI_groups <- GBD_shares_grouped %>% left_join(OC_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
GBD_SO2_SDI_groups <- GBD_shares_grouped %>% left_join(SO2_FFI_fraction_grouped, by = c("SDI Quintile", "year"))
# Relationship between composite PM emissions and deaths ------------------------------------------------------------
# Merge composite PM emissions, GBD data, and population
GBD_population_PM <- GBD_composite_PM %>% left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = cntry_pm * pop)
GBD_population_PM_BioBAvg <- GBD_composite_PM_BioBAvg %>% left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop)
# get slopes by country to extrapolate deaths in previous years
# use slope in early years for countries where slope changes
extrap_years <- c(1850:1989)
extrap_isos <- c("chn", "ind", "fra")
actual_years <- c(1990:2017)
fra_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "fra", year <= 2002,
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
ind_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "ind",
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
chn_PM_deaths_lm <- lm(formula = val ~ pm_pop,
data=filter(GBD_population_PM, iso == "chn", year <= 1996,
measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"))
extrap_PM_deaths_frac <- composite_PM %>%
left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop) %>%
na.omit() %>%
left_join(filter(GBD_shares, measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"), by = c("location_id", "year")) %>%
select(c(iso, location_id, country, year, total_pm, FFI, non_FFI, `SDI Quintile`, rei_name, pop, pm_pop, val)) %>%
filter(year %in% extrap_years,
iso %in% extrap_isos)
actual_PM_deaths_frac <- composite_PM %>%
left_join(CEDS_pop, by = c("iso", "year")) %>%
dplyr::mutate(pm_pop = total_pm * pop) %>%
na.omit() %>%
left_join(filter(GBD_shares, measure_name == "Deaths", rei_name == "Ambient PM pollution / All risk factors"), by = c("location_id", "year")) %>%
select(c(iso, location_id, country, year, total_pm, FFI, non_FFI, `SDI Quintile`, rei_name, pop, pm_pop, val)) %>%
filter(year %in% actual_years,
iso %in% extrap_isos)
# extrapolate PM deaths fraction  for each country
extrap_PM_deaths_chn <- extrap_PM_deaths_frac %>%
filter(iso == "chn")
extrap_PM_deaths_chn$val <- predict(chn_PM_deaths_lm, new = extrap_PM_deaths_chn)
extrap_PM_deaths_ind <- extrap_PM_deaths_frac %>%
filter(iso == "ind")
extrap_PM_deaths_ind$val <- predict(ind_PM_deaths_lm, new = extrap_PM_deaths_ind)
extrap_PM_deaths_fra <- extrap_PM_deaths_frac %>%
filter(iso == "fra")
extrap_PM_deaths_fra$val <- predict(fra_PM_deaths_lm, new = extrap_PM_deaths_fra)
PM_deaths_frac_cntry_allyears_extrap <- bind_rows(actual_PM_deaths_frac,
extrap_PM_deaths_chn,
extrap_PM_deaths_ind,
extrap_PM_deaths_fra)
GBD_years
library(gganimate)
library(RColorBrewer)
em_species <- c("BC", "CH4", "CO", "NH3", "NMVOC", "NOx", "OC", "SO2")
health_indicators <- c("Air pollution / All risk factors", "Environ-Occup / All risk factors")
measures <- c("Deaths", "DALYs")
SDI_groups <- c("Low SDI", "Low-middle SDI", "Middle SDI", "High-middle SDI", "High SDI")
plot_theme <- theme_bw() + theme(text = element_text(size = 20),
plot.title = element_text(size = 24, margin = margin(0, 0, 10, 0)),
strip.text.x = element_text(size = 16),
axis.text = element_text(size = 20))
# Composite PM (open burning average), animated ------------------------------------------------------------------------
GBD_composite_PM_BioBAvg$`SDI Quintile` <- factor(GBD_composite_PM_BioBAvg$`SDI Quintile`, levels = SDI_groups)
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot <-
ggplot() +
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`,  shape = `SDI Quintile`), size = 3) +
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
transition_time(as.integer(year)) +
labs(title = "Year: {frame_time}", x="Fossil_Industrial Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
animate(plot, nframes = 100, fps = 5, width = 600, height = 400, start_pause = 5, end_pause = 20)
anim_save(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_anim", "_BioBAvg", ".gif"))
}
}
# Composite PM (open burning average), still with trajectory lines -----------------------------------------------------------------
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2017
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 3) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = "-", size = 4) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2017
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 5) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = "-", size = 4) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2017
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 4.5) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = "-", size = 4) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2017
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 4.5) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 9) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = "-", size = 4) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2017
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = "-", size = 4) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
source('~/Air pollution health emissions/figures.R', echo=TRUE)
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2015
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 3) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = 13, size = 1) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 4) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
source('~/Air pollution health emissions/figures.R', echo=TRUE)
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2015
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 3) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = 13, size = 1) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 5) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme+
theme(axis.text = element_text(size=20))
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
for (i in seq_along(health_indicators)) {
health_indicator <- health_indicators[i]
for (j in seq_along(measures)) {
measure <- measures[j]
plot_year <- 2015
plot <-
ggplot() +
# individual country points
geom_point(data=filter(GBD_composite_PM_BioBAvg, location_id %in% c(countries_id), measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, group = location_name, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 3) +
# SDI group averages
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year == plot_year),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, fill = `SDI Quintile`, shape = `SDI Quintile`), size = 8) +
#small points for trail
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
aes(x=FFI_fraction, y=val, color = `SDI Quintile`), shape = 13, size = 1) +
# geom_line(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year %in% c(1991:plot_year)),
#            aes(x=FFI_fraction, y=val, color = `SDI Quintile`), linetype = "dashed", size = 1) +
# open point for 1990
geom_point(data=filter(GBD_composite_PM_grouped_BioBAvg, measure_name == measure, rei_name == health_indicator, year==1990),
aes(x=(FFI_fraction), y=val, color = `SDI Quintile`, shape = `SDI Quintile`), size = 5) +
labs(x="Fossil Fraction of Composite PM Emissions",
y = paste(measure, "from", health_indicator)) +
scale_y_continuous(limits = c(0, NA),
labels = scales::percent_format(accuracy = 1L)) +
scale_x_continuous(labels = scales::percent_format(accuracy = 1L)) +
scale_color_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_fill_manual(name = "Socio-Demographic Index",
values = brewer.pal(5, "Set1")) +
scale_shape_manual(name = "Socio-Demographic Index",
values = c(21, 22, 25, 23, 24)) +
plot_theme+
theme(axis.text = element_text(size=20))
ggsave(filename=paste0("./figures/", "PM", "_", measure, "_", gsub(" / ", "_", health_indicator), "_still", "_BioBAvg", ".png"),
height = 8.5, width = 11, units = "in")
}
}
View(PM_CEDS_total)
View(open_burn_avg_PM_em)
# Multiply open burning emissions by PM emissions factors and sum to get open burning composite PM
open_burn_avg_PM_em <- bind_rows(GFED_BC_BioBAvg %>% dplyr::mutate(species = "BC", EF = PM_CF_BC),
GFED_NH3_BioBAvg %>% dplyr::mutate(species = "NH3", EF = PM_CF_NH3),
GFED_NOx_BioBAvg %>% dplyr::mutate(species = "NO2", EF = PM_CF_NO2),
GFED_SO2_BioBAvg %>% dplyr::mutate(species = "SO2", EF = PM_CF_SO2),
GFED_OC_BioBAvg %>% dplyr::mutate(species = "OC", EF = PM_CF_OC_biomass)) %>%
gather(-c(iso, species, EF), key = "year", value = "value_timeAvg") %>%
dplyr::mutate(year = as.integer(gsub(".*X","", year))) %>%
dplyr::mutate(PM_em = value_timeAvg * EF) %>%
group_by(iso, year) %>%
dplyr::summarise(open_burn = sum(PM_em, na.rm = TRUE))
PM_composition_open_burn_BioBAvg <- PM_CEDS_total %>%
left_join(open_burn_avg_PM_em, by = c("iso", "year"))
View(PM_composition_open_burn_BioBAvg)
PM_composition_open_burn_BioBAvg <- PM_CEDS_total %>%
left_join(open_burn_avg_PM_em, by = c("iso", "year")) %>%
gather(c(BC, NH3, NO2, OC, SO2, open_burn), key = "emissions_type", value = "value")
source('~/Air pollution health emissions/figures.R', echo=TRUE)
